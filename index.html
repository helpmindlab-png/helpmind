<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MindSpark</title>

<style>
:root{
  --bg:#ffffff;
  --card: rgba(255,255,255,.92);
  --line: rgba(15,23,42,.10);
  --text:#111827;
  --muted:#64748b;
  --brand:#6d5efc;
  --rose:#ff6fae;
  --sky:#38bdf8;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR";
  background:
    radial-gradient(900px 700px at 15% 10%, rgba(109,94,252,.12), transparent 60%),
    radial-gradient(800px 600px at 85% 15%, rgba(255,111,174,.10), transparent 60%),
    var(--bg);
  color:var(--text);
}

.wrap{max-width:720px;margin:0 auto;padding:20px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:22px;
  padding:20px;
  box-shadow:0 18px 48px rgba(2,6,23,.08);
}
button{
  padding:14px;
  border-radius:14px;
  border:none;
  font-weight:700;
  cursor:pointer;
}
.primary{
  background:linear-gradient(135deg,var(--brand),var(--rose));
  color:#fff;
}
.choice{
  width:100%;
  margin:8px 0;
  background:#fff;
  border:1px solid var(--line);
}
.progress{
  height:8px;
  background:#eee;
  border-radius:999px;
  overflow:hidden;
  margin-bottom:10px;
}
.fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--brand),var(--rose));
}
.hidden{display:none}
</style>
</head>
<body>

<div class="wrap">
  <div class="card" id="app"></div>
</div>

<script>
/* ===== 상태 (메모리만 사용) ===== */
let state={
  step:"intro",
  index:0,
  answers:[],
  results:{}
};

/* ===== 문항 ===== */
const tests={
  social:{
    title:"사회적 에너지",
    questions:[
      "사람들과 함께 있으면 에너지가 오른다.",
      "모임 후에는 혼자 시간이 꼭 필요하다.",
      "낯선 사람과 대화가 부담되지 않는다.",
      "사람 많은 자리는 피하고 싶다.",
      "즉흥 약속을 즐긴다.",
      "여럿과 함께 있으면 빨리 지친다.",
      "대화를 주도하는 편이다.",
      "조용한 환경이 더 편하다."
    ]
  }
};

/* ===== 시작 화면 ===== */
function renderIntro(){
  app.innerHTML=`
    <h2>사회적 에너지 테스트</h2>
    <p>3분 소요 · 저장하지 않습니다</p>
    <button class="primary" onclick="startTest()">시작하기</button>
  `;
}

/* ===== 테스트 ===== */
function startTest(){
  state.step="test";
  state.index=0;
  state.answers=[];
  renderQuestion();
}

function renderQuestion(){
  const q=tests.social.questions[state.index];
  const percent=(state.index/tests.social.questions.length)*100;

  app.innerHTML=`
    <div class="progress"><div class="fill" style="width:${percent}%"></div></div>
    <h3>${state.index+1} / ${tests.social.questions.length}</h3>
    <p>${q}</p>
    ${[1,2,3,4,5].map(v=>
      `<button class="choice" onclick="select(${v})">${v}</button>`
    ).join("")}
  `;
}

function select(v){
  state.answers.push(v);
  state.index++;
  if(state.index>=tests.social.questions.length){
    showResult();
  }else{
    renderQuestion();
  }
}

/* ===== 결과 ===== */
function showResult(){
  const avg = state.answers.reduce((a,b)=>a+b)/state.answers.length;
  state.results.socialEnergy=avg;

  app.innerHTML=`
    <h2>결과</h2>
    <p>Score ${avg.toFixed(1)}</p>
    <button class="primary" onclick="showProfile()">프로파일 보기</button>
  `;
}

/* ===== 프로파일 화면 ===== */
function showProfile(){
  app.innerHTML=`
    <h2>에너지 프로파일</h2>
    <canvas id="canvas" width="800" height="1000"></canvas>
    <button class="primary" onclick="downloadImage()">이미지 저장</button>
  `;
  drawProfile();
}

/* ===== 프로파일 이미지 생성 ===== */
function drawProfile(){
  const canvas=document.getElementById("canvas");
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#111";
  ctx.font="bold 40px system-ui";
  ctx.fillText("에너지 프로파일",100,100);

  const score=state.results.socialEnergy||3;
  ctx.fillText("사회적 에너지: "+score.toFixed(1),100,200);

  ctx.strokeStyle="#6d5efc";
  ctx.lineWidth=10;
  ctx.strokeRect(100,250,score*100,40);
}

/* ===== 이미지 다운로드 ===== */
function downloadImage(){
  const canvas=document.getElementById("canvas");
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/png");
  a.download="profile.png";
  a.click();
}

/* ===== 초기화 ===== */
const app=document.getElementById("app");
renderIntro();
</script>

</body>
</html>
